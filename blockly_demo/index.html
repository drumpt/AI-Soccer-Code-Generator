<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AIWC CODE GENERATOR - Rule Based System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="style.css">
  <script src="blockly_compressed.js"></script>
  <script src="python_compressed.js"></script>
  <script src="blocks_compressed.js"></script>
  <script src="code.js"></script>
  <script src="msg/js/en.js"></script>
  <script src="toolbox_standard.js"></script>
</head>
<body>
  <p>AI World Cup Code Generator - Rule Based System</p>
  <img src="./img/field_region_names.png" style="margin-left: auto; margin-right:auto; display:block; max-width: 30%; height:auto	;">

	<!-- for split screen into block part and code part -->
	<div class='codeContainer' id='codeContainer'>
		<div id="blocklyDiv" style="height: 600px; width: 67%; border: 0.5px solid #DDDDDD;" onchange="showCode();">
			<xml xmlns="https://developers.google.com/blockly/xml" id="startBlocks" style="display:none;">
				<block type="controls_if" inline="false" x="20" y="20">
					<mutation else="1"></mutation>
					<value name="IF0">
						<block type="logic_compare" inline="true">
							<field name="OP">EQ</field>
							<value name="A">
								<block type="math_arithmetic" inline="true">
									<field name="OP">MULTIPLY</field>
									<value name="A">
										<block type="math_number">
											<field name="NUM">6</field>
										</block>
									</value>
									<value name="B">
										<block type="math_number">
											<field name="NUM">7</field>
										</block>
									</value>
								</block>
							</value>
							<value name="B">
								<block type="math_number">
									<field name="NUM">42</field>
								</block>
							</value>
						</block>
					</value>
					<statement name="DO0">
						<block type="text_print" inline="false">
							<value name="TEXT">
								<block type="text">
									<field name="TEXT">Don't panic</field>
								</block>
							</value>
						</block>
					</statement>
					<statement name="ELSE">
						<block type="text_print" inline="false">
							<value name="TEXT">
								<block type="text">
									<field name="TEXT">Panic</field>
								</block>
							</value>
						</block>
					</statement>
				</block>
			</xml>
		</div>

		<div id="blocklyText" style="height: auto; width: 33%; border: 1px solid #DDDDDD; padding: 10px">
			<h1><span>Generated Python Code</span></h1>
			<pre translate="no" dir="ltr"></pre>
		</div>

		<script type="text/javascript">
			var workspacePlayground = Blockly.inject('blocklyDiv', {
						media: 'media/',
						toolbox: BLOCKLY_TOOLBOX_XML['standard'],
						zoom: {controls: true}
					});
		
			Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'), workspacePlayground);

			function saveCode() {
				// Generate python script and show it
				var code = Blockly.Python.workspaceToCode(workspacePlayground);
				var link = document.createElement("a");
				link.href = 'data:attachment/text,' + encodeURI(code);
				link.target = '_blank';
				link.download = "players.py";
				link.click();
				console.log(code);
			}

			function showCode(event) {
				var codeDiv = document.getElementById('blocklyText');
				var codeHolder = document.createElement('pre');
				var code = document.createTextNode(Blockly.Python.workspaceToCode(workspacePlayground));
				codeHolder.appendChild(code);
				codeDiv.replaceChild(codeHolder, codeDiv.lastElementChild);
				// prettyPrint();
			}
			workspacePlayground.addChangeListener(showCode);
		</script>
	</div>

	<button type="button" onclick="saveCode();">Generate Code</button>
</body>
</html>