<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AIWC CODE GENERATOR - Deep Learning System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="style_deep_learning.css">
  <script src="deeplearning_codes.js"></script>
  <script src="params.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.2.0/jszip.min.js"></script>
</head>
<body>
  <p>AI World Cup Code Generator - Deep Learning System</p>
  <img src="./img/field_information_3d.png" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; display:block; max-width: 50%; height:auto;">

  <!--
  <div class="tab" style="margin-left: auto; margin-right:auto; margin-bottom: 0px; max-width: 50%; height:auto;">
    <button class="tablinks" onclick="chooseType('SR')">Single Robot</button>
    <button class="tablinks" onclick="chooseType('MR')">Multiple Robots</button>
  </div>
  -->

  <!-- define codeContainer for splitting screen into block part and code part --> 
  <div id='codeContainer' style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%; border: 2px solid #DDDDDD; height: 1450px">

    <form>
        <div class="form-group" style="margin-left: auto; margin-right:auto; margin-top: 15px; margin-bottom: 15px; width: 50%;">
            <label for="selectState">Select your State design</label>
            <select class="form-control" id="selectState">
                <option>ROBOT_RELATIVE_POSITION</option>
                <option>ROBOT_COORDINATES</option>
                <option>ROBOT_COORDINATES_AND_LIDAR</option>
            </select>
            <small id="stateHelpBlock" class="form-text text-muted">
                There are currently 3 possible state options: <br>
                1) Option 1 <br>
                2) Option 2 <br>
                3) Option 3
            </small>
        </div>    
        <div class="form-group" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <label for="selectAction">Select your Action design</label>
            <select class="form-control" id="selectAction">
                <option>10_DISCRETE_ACTIONS</option>
                <option>20_DISCRETE_ACTIONS</option>
                <option>CONTINUOUS_ACTIONS</option>
            </select>
            <small id="actionHelpBlock" class="form-text text-muted">
                There are currently 3 possible action options: <br>
                1) Option 1 <br>
                2) Option 2 <br>
                3) Option 3
            </small>
            </div>  
        <div class="form-group" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <label for="selectReward">Select your Reward design</label>
            <select class="form-control" id="selectReward">
                <option>ROBOT_TO_BALL</option>
                <option>BALL_TO_OPPONENT_GOAL</option>
                <option>GOAL_SCORED</option>
            </select>
            <small id="rewardHelpBlock" class="form-text text-muted">
                Design your reward function: <br>
                Return: reward value for one timestep
            </small>
        </div>
        <!-- <div class="form-row"  style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="dqn_algorithm" value="dqn">
                <label class="form-check-label" for="dqn_algorithm">DQN</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="ddqn_algorithm" value="ddqn">
                <label class="form-check-label" for="ddqn_algorithm">DDQN</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="ddpg_algorithm" value="ppo" disabled>
                <label class="form-check-label" for="ddpg_algorithm">DDPG (disabled)</label>
            </div>
        </div> -->
        <div style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            Choose which robots to train
        </div> 
        <div class="custom-control custom-switch" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <input type="checkbox" class="custom-control-input" id="switchGK">
            <label class="custom-control-label" for="switchGK">GK</label>
        </div>
        <div class="custom-control custom-switch" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <input type="checkbox" class="custom-control-input" id="switchD1">
            <label class="custom-control-label" for="switchD1">D1</label>
        </div>
        <div class="custom-control custom-switch" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <input type="checkbox" class="custom-control-input" id="switchD2">
            <label class="custom-control-label" for="switchD2">D2</label>
        </div>
        <div class="custom-control custom-switch" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <input type="checkbox" class="custom-control-input" id="switchF1">
            <label class="custom-control-label" for="switchF1">F1</label>
        </div>
        <div class="custom-control custom-switch" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <input type="checkbox" class="custom-control-input" id="switchF2" checked>
            <label class="custom-control-label" for="switchF2">F2</label>
            <small id="chooseRobotHelpBlock" class="form-text text-muted">
                Choose just one robot to train
            </small>
        </div>
        <div class="form-group" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
            <label for="frameskipInput">Frame Skip</label>
            <input type="text" class="form-control" id="frameskipInput" placeholder="4">
            <small id="frameskipHelpBlock" class="form-text text-muted">
                Store experiences every 'frame_skip' value timesteps
            </small>
        </div>
    </form>

    <div style="margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;">
        Choose your Deep Reinforcement Learning algorithm
    </div>
    <div id="dl-block" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; max-width: 50%; height:auto;">
        <div class="tab" style="margin-left: auto; margin-right:auto; margin-bottom: 15px; max-width: 50%; height:auto;">
            <button class="tablinks" onclick="chooseType('DQN')">DQN</button>
            <button class="tablinks" onclick="chooseType('DDPG')">DDPG</button>
        </div>
    </div>

    <script type="text/javascript">
        
        // Need to modify when I try to modify the variables above
        var code_dqn = DQN;
        var code_episode_memory = EPISODE_MEMORY;
        var code_helper = HELPER;
        var code_networks = NETWORKS;
        var code_play = PLAY;
        var code_rl_utils = RL_UTILS;
        var code_train = TRAIN;

        var tablinks = document.getElementsByClassName("tablinks");
        tablinks[0].className += " active";
        var currentType = 'DQN';
        
        createDQNform();

        var json_data = JSON.parse(SINGLE_PARAMETERS)

        function get_form_data () {
            var frameskip = document.getElementById("frameskipInput");
            if (frameskip.value) {
                json_data.sim_parameters.frame_skip = parseInt(frameskip.value)
            }
            switch (currentType) {
                case "DQN":
                    var gamma = document.getElementById("gammaInput");
                    var batchsize = document.getElementById("batchSizeInput");
                    var buffersize = document.getElementById("bufferSizeInput");
                    var lr = document.getElementById("learningRateInput");
                    var epsilonsteps = document.getElementById("epsilonStepsInput");
                    if (gamma.value) {
                        json_data.dqn_parameters.gamma = parseFloat(gamma.value)
                    }
                    if (batchsize.value) {
                        json_data.dqn_parameters.batch_size = parseInt(batchsize.value)
                    }
                    if (buffersize.value) {
                        json_data.dqn_parameters.buffer_size = parseInt(buffersize.value)
                    }
                    if (lr.value) {
                        json_data.dqn_parameters.lr = parseFloat(lr.value)
                    }
                    if (epsilonsteps.value) {
                        json_data.dqn_parameters.epsilon_steps = parseInt(epsilonsteps.value)
                    }
                break;
                case "DDPG":
                    var gamma = document.getElementById("gammaInput");
                    var batchsize = document.getElementById("batchSizeInput");
                    var buffersize = document.getElementById("bufferSizeInput");
                    var lr = document.getElementById("learningRateInput");
                    var expnoise = document.getElementById("expNoiseInput");
                    if (gamma.value) {
                        json_data.ddpg_parameters.gamma = parseFloat(gamma.value)
                    }
                    if (batchsize.value) {
                        json_data.ddpg_parameters.batch_size = parseInt(batchsize.value)
                    }
                    if (buffersize.value) {
                        json_data.ddpg_parameters.buffer_size = parseInt(buffersize.value)
                    }
                    if (lr.value) {
                        json_data.ddpg_parameters.lr = parseFloat(lr.value)
                    }
                    if (expnoise.value) {
                        json_data.ddpg_parameters.exploration_noise = parseFloat(expnoise.value)
                    }
                break;
            default:
                console.log("Error: type does not exist.");
            }
        }
        
        function getRobot () {

            var switch_GK = document.getElementById("switchGK");
            var switch_D1 = document.getElementById("switchD1");
            var switch_D2 = document.getElementById("switchD2");
            var switch_F1 = document.getElementById("switchF1");
            var switch_F2 = document.getElementById("switchF2");

            json_data.sim_parameters.robot = [switch_GK.checked, switch_D1.checked, switch_D2.checked, switch_F1.checked, switch_F2.checked];

            var counts = {};
            json_data.sim_parameters.robot.forEach(function(x) { counts[x] = (counts[x] || 0)+1; });

            return counts;
        }
        
        function saveCode() {

            get_form_data();
            counts = getRobot();

            if (counts['true'] != 1) {
                alert('Choose just one robot.');
            }

            // var link = document.createElement("a");
            // var dqn_blob = new Blob([code_dqn], {type: 'text/plain'});
            // var episode_memory_blob = new Blob([code_episode_memory], {type: 'text/plain'});
            // var helper_blob = new Blob([code_helper], {type: 'text/plain'});
            // var networks_blob = new Blob([code_networks], {type: 'text/plain'});
            // var play_blob = new Blob([code_play], {type: 'text/plain'});
            // var rl_utils_blob = new Blob([code_rl_utils], {type: 'text/plain'});
            // var train_blob = new Blob([code_train], {type: 'text/plain'});
            // var params_blob = new Blob([JSON.stringify(json_data)], {type: 'text/plain'});

            // var zip = new JSZip();
            // zip.file("dqn"+".py", dqn_blob, {type: 'text/plain'});
            // zip.file("episode_memory"+".py", episode_memory_blob, {type: 'text/plain'});
            // zip.file("helper"+".py", helper_blob, {type: 'text/plain'});
            // zip.file("networks"+".py", networks_blob, {type: 'text/plain'});
            // zip.file("play"+".py", play_blob, {type: 'text/plain'});
            // zip.file("rl_utils"+".py", rl_utils_blob, {type: 'text/plain'});
            // zip.file("train"+".py", train_blob, {type: 'text/plain'});
            // zip.file("params"+".json", params_blob, {type: 'text/plain'});

            // zip.generateAsync({type:"blob"}).then(function(content) {
            //     // see FileSaver.js
            //     saveAs(content, "mystrategy.zip");
            // });
        }

        function chooseType(position) {

            var dlDiv = document.getElementById("dl-block");
            var tablinks = document.getElementsByClassName("tablinks");
            document.getElementById("parametersblock-id").remove();
            for (var i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            currentType = position;
            switch (position) {
                case "DQN":
                    tablinks[0].className += " active";
                    createDQNform();
                break;
                case "DDPG":
                    tablinks[1].className += " active";
                    createDDPGform();
                break;
            default:
                console.log("Error: type does not exist.");
            }
        }

        function createDQNform(){
            
            // need to start form tag
            var dlDiv = document.getElementById("dl-block");
            var innerDiv = document.createElement('div');
            innerDiv.className = 'parametersBlock';
            innerDiv.id = 'parametersblock-id';
            dlDiv.appendChild(innerDiv);

            // gamma
            var gamma_form = document.createElement('div');
            gamma_form.className = "form-group";
            gamma_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var gamma_label = document.createElement('label');
            gamma_label.for = "gammaInput";
            gamma_label.innerHTML = "Gamma: ";
            gamma_form.appendChild(gamma_label);
            var gamma_input = document.createElement('input');
            gamma_input.type = "text";
            gamma_input.class = "form-control";
            gamma_input.id = "gammaInput";
            gamma_input.placeholder = "0.99";
            gamma_form.appendChild(gamma_input);
            var gamma_small = document.createElement('small');
            gamma_small.id = "gammaHelpBlock";
            gamma_small.class = "form-text text-muted";
            gamma_small.innerHTML = "(float)";
            gamma_form.appendChild(gamma_small);
            innerDiv.appendChild(gamma_form);

            // batch size
            var batch_form = document.createElement('div');
            batch_form.className = "form-group";
            batch_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var batch_label = document.createElement('label');
            batch_label.for = "batchSizeInput";
            batch_label.innerHTML = "Batch Size: ";
            batch_form.appendChild(batch_label);
            var batch_input = document.createElement('input');
            batch_input.type = "text";
            batch_input.class = "form-control";
            batch_input.id = "batchSizeInput";
            batch_input.placeholder = "32";
            batch_form.appendChild(batch_input);
            var batch_small = document.createElement('small');
            batch_small.id = "batchHelpBlock";
            batch_small.class = "form-text text-muted";
            batch_small.innerHTML = "(integer)";
            batch_form.appendChild(batch_small);
            innerDiv.appendChild(batch_form);

            // buffer size
            var buffer_form = document.createElement('div');
            buffer_form.className = "form-group";
            buffer_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var buffer_label = document.createElement('label');
            buffer_label.for = "bufferSizeInput";
            buffer_label.innerHTML = "Buffer Size: ";
            buffer_form.appendChild(buffer_label);
            var buffer_input = document.createElement('input');
            buffer_input.type = "text";
            buffer_input.class = "form-control";
            buffer_input.id = "bufferSizeInput";
            buffer_input.placeholder = "50000";
            buffer_form.appendChild(buffer_input);
            var buffer_small = document.createElement('small');
            buffer_small.id = "bufferHelpBlock";
            buffer_small.class = "form-text text-muted";
            buffer_small.innerHTML = "(integer)";
            buffer_form.appendChild(buffer_small);
            innerDiv.appendChild(buffer_form);

            // learning rate
            var lr_form = document.createElement('div');
            lr_form.className = "form-group";
            lr_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var lr_label = document.createElement('label');
            lr_label.for = "learningRateInput";
            lr_label.innerHTML = "Learning Rate: ";
            lr_form.appendChild(lr_label);
            var lr_input = document.createElement('input');
            lr_input.type = "text";
            lr_input.class = "form-control";
            lr_input.id = "learningRateInput";
            lr_input.placeholder = "0.001";
            lr_form.appendChild(lr_input);
            var lr_small = document.createElement('small');
            lr_small.id = "lrHelpBlock";
            lr_small.class = "form-text text-muted";
            lr_small.innerHTML = "(float)";
            lr_form.appendChild(lr_small);
            innerDiv.appendChild(lr_form);

            // epsilon_steps
            var epsilon_form = document.createElement('div');
            epsilon_form.className = "form-group";
            epsilon_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var epsilon_label = document.createElement('label');
            epsilon_label.for = "epsilonStepsInput";
            epsilon_label.innerHTML = "Epsilon Steps: ";
            epsilon_form.appendChild(epsilon_label);
            var epsilon_input = document.createElement('input');
            epsilon_input.type = "text";
            epsilon_input.class = "form-control";
            epsilon_input.id = "epsilonStepsInput";
            epsilon_input.placeholder = "20000";
            epsilon_form.appendChild(epsilon_input);
            var epsilon_small = document.createElement('small');
            epsilon_small.id = "epsilonHelpBlock";
            epsilon_small.class = "form-text text-muted";
            epsilon_small.innerHTML = "(integer)";
            epsilon_form.appendChild(epsilon_small);
            innerDiv.appendChild(epsilon_form);

        }

        function createDDPGform(){

            // need to start form tag
            var dlDiv = document.getElementById("dl-block");
            var innerDiv = document.createElement('div');
            innerDiv.className = 'parametersBlock';
            innerDiv.id = 'parametersblock-id';
            dlDiv.appendChild(innerDiv);

            // gamma
            var gamma_form = document.createElement('div');
            gamma_form.className = "form-group";
            gamma_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var gamma_label = document.createElement('label');
            gamma_label.for = "gammaInput";
            gamma_label.innerHTML = "Gamma: ";
            gamma_form.appendChild(gamma_label);
            var gamma_input = document.createElement('input');
            gamma_input.type = "text";
            gamma_input.class = "form-control";
            gamma_input.id = "gammaInput";
            gamma_input.placeholder = "0.99";
            gamma_form.appendChild(gamma_input);
            var gamma_small = document.createElement('small');
            gamma_small.id = "gammaHelpBlock";
            gamma_small.class = "form-text text-muted";
            gamma_small.innerHTML = "(float)";
            gamma_form.appendChild(gamma_small);
            innerDiv.appendChild(gamma_form);

            // batch size
            var batch_form = document.createElement('div');
            batch_form.className = "form-group";
            batch_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var batch_label = document.createElement('label');
            batch_label.for = "batchSizeInput";
            batch_label.innerHTML = "Batch Size: ";
            batch_form.appendChild(batch_label);
            var batch_input = document.createElement('input');
            batch_input.type = "text";
            batch_input.class = "form-control";
            batch_input.id = "batchSizeInput";
            batch_input.placeholder = "32";
            batch_form.appendChild(batch_input);
            var batch_small = document.createElement('small');
            batch_small.id = "batchHelpBlock";
            batch_small.class = "form-text text-muted";
            batch_small.innerHTML = "(integer)";
            batch_form.appendChild(batch_small);
            innerDiv.appendChild(batch_form);

            // buffer size
            var buffer_form = document.createElement('div');
            buffer_form.className = "form-group";
            buffer_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var buffer_label = document.createElement('label');
            buffer_label.for = "bufferSizeInput";
            buffer_label.innerHTML = "Buffer Size: ";
            buffer_form.appendChild(buffer_label);
            var buffer_input = document.createElement('input');
            buffer_input.type = "text";
            buffer_input.class = "form-control";
            buffer_input.id = "bufferSizeInput";
            buffer_input.placeholder = "50000";
            buffer_form.appendChild(buffer_input);
            var buffer_small = document.createElement('small');
            buffer_small.id = "bufferHelpBlock";
            buffer_small.class = "form-text text-muted";
            buffer_small.innerHTML = "(integer)";
            buffer_form.appendChild(buffer_small);
            innerDiv.appendChild(buffer_form);

            // learning rate
            var lr_form = document.createElement('div');
            lr_form.className = "form-group";
            lr_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var lr_label = document.createElement('label');
            lr_label.for = "learningRateInput";
            lr_label.innerHTML = "Learning Rate: ";
            lr_form.appendChild(lr_label);
            var lr_input = document.createElement('input');
            lr_input.type = "text";
            lr_input.class = "form-control";
            lr_input.id = "learningRateInput";
            lr_input.placeholder = "0.002";
            lr_form.appendChild(lr_input);
            var lr_small = document.createElement('small');
            lr_small.id = "lrHelpBlock";
            lr_small.class = "form-text text-muted";
            lr_small.innerHTML = "(float)";
            lr_form.appendChild(lr_small);
            innerDiv.appendChild(lr_form);

            // exploration noise
            var expnoise_form = document.createElement('div');
            expnoise_form.className = "form-group";
            expnoise_form.style = "margin-left: auto; margin-right:auto; margin-bottom: 15px; width: 50%;";
            var expnoise_label = document.createElement('label');
            expnoise_label.for = "expNoiseInput";
            expnoise_label.innerHTML = "Exploration Noise: ";
            expnoise_form.appendChild(expnoise_label);
            var expnoise_input = document.createElement('input');
            expnoise_input.type = "text";
            expnoise_input.class = "form-control";
            expnoise_input.id = "expNoiseInput";
            expnoise_input.placeholder = "0.2";
            expnoise_form.appendChild(expnoise_input);
            var expnoise_small = document.createElement('small');
            expnoise_small.id = "expnoiseHelpBlock";
            expnoise_small.class = "form-text text-muted";
            expnoise_small.innerHTML = "(float)";
            expnoise_form.appendChild(expnoise_small);
            innerDiv.appendChild(expnoise_form);

        }

    </script>

  </div>

  <button id="saveButton" onclick="saveCode();">Generate Code</button>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>  
</body>
</html>